<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>AimLab 3D Mini</title>
<style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { overflow:hidden; font-family:sans-serif; background:#000; color:#fff; touch-action:none; }
    #menu { position:fixed; top:0; left:0; width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; background:linear-gradient(135deg,#0f0c29,#302b63,#24243e); }
    #menu h1 { font-size:4rem; margin-bottom:40px; background:linear-gradient(45deg,#00f5ff,#ff00ff); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .mode-btn { padding:20px 40px; margin:10px; font-size:1.5rem; cursor:pointer; border:2px solid #00f5ff; border-radius:10px; background:rgba(0,0,0,0.5); transition:0.3s; }
    .mode-btn:hover { background:rgba(0,245,255,0.2); transform:scale(1.05); }
    #start-btn { margin-top:30px; padding:15px 50px; font-size:1.5rem; border:none; border-radius:50px; background:linear-gradient(135deg,#00f5ff,#7b00ff); cursor:pointer; transition:0.3s; }
    #start-btn:hover { transform:scale(1.05); }
    #canvas-container { position:fixed; top:0; left:0; width:100%; height:100%; display:none; }
    #hud { position:fixed; top:0; left:0; width:100%; display:flex; justify-content:space-between; padding:20px; pointer-events:none; }
    .hud-item { background:rgba(0,0,0,0.6); padding:10px 20px; border-radius:10px; font-size:1.2rem; border:2px solid #00f5ff; }
    #crosshair { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:4px; height:4px; background:#0f0; z-index:10; }
    #mobile-controls { position:fixed; bottom:20px; left:0; right:0; display:none; pointer-events:none; }
    .joystick-container { position:fixed; bottom:30px; left:30px; width:120px; height:120px; border:3px solid rgba(0,245,255,0.5); border-radius:50%; background:rgba(255,255,255,0.05); pointer-events:auto; }
    .joystick { width:50px; height:50px; background:rgba(0,245,255,0.8); border-radius:50%; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); pointer-events:none; }
    .shoot-btn { position:fixed; bottom:40px; right:30px; width:80px; height:80px; border-radius:50%; background:rgba(255,0,0,0.3); border:3px solid rgba(255,0,0,0.7); font-size:2rem; display:flex; align-items:center; justify-content:center; pointer-events:auto; }
</style>
</head>
<body>
<div id="menu">
    <h1>AimLab Mini</h1>
    <button class="mode-btn" data-mode="gridshot">Gridshot</button>
    <button id="start-btn" disabled>DÃ©marrer</button>
</div>

<div id="canvas-container"></div>
<div id="hud">
    <div class="hud-item">Score: <span id="score">0</span></div>
    <div class="hud-item">Timer: <span id="timer">60</span></div>
</div>
<div id="crosshair"></div>

<div id="mobile-controls">
    <div class="joystick-container">
        <div class="joystick" id="joystick"></div>
    </div>
    <div class="shoot-btn" id="shoot-btn">ðŸŽ¯</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
let scene, camera, renderer, raycaster;
let targets = [], weapon;
let score=0, totalShots=0, hits=0, gameTime=60, isPlaying=false;
let keys={}, move={forward:false,back:false,left:false,right:false};
let isMobile='ontouchstart' in window;
const modeConfig={gridshot:{count:6,size:1.5,spacing:3}};
const menu=document.getElementById('menu'), startBtn=document.getElementById('start-btn'), canvasContainer=document.getElementById('canvas-container');
const scoreEl=document.getElementById('score'), timerEl=document.getElementById('timer');
const crosshair=document.getElementById('crosshair'), mobileControls=document.getElementById('mobile-controls');
const joystickEl=document.getElementById('joystick'), shootBtn=document.getElementById('shoot-btn');

document.querySelectorAll('.mode-btn').forEach(b=>b.addEventListener('click',()=>{modeConfig.selected=b.dataset.mode; startBtn.disabled=false;}));
startBtn.addEventListener('click',()=>{menu.style.display='none'; canvasContainer.style.display='block'; if(isMobile) mobileControls.style.display='block'; startGame();});
if(isMobile) {shootBtn.addEventListener('touchstart',shoot); } else { document.addEventListener('mousedown',e=>{if(e.button===0) shoot();});}

function startGame(){
    score=0; hits=0; totalShots=0; gameTime=60; isPlaying=true;
    initThree(); createTargets(); setInterval(()=>{gameTime--; timerEl.textContent=gameTime; if(gameTime<=0) endGame();},1000); animate();
}

function initThree(){
    scene=new THREE.Scene(); scene.background=new THREE.Color(0x000000);
    camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000); camera.position.set(0,1.6,5);
    renderer=new THREE.WebGLRenderer({antialias:true}); renderer.setSize(window.innerWidth,window.innerHeight); canvasContainer.appendChild(renderer.domElement);
    raycaster=new THREE.Raycaster();

    // Sol
    let floor=new THREE.Mesh(new THREE.PlaneGeometry(50,50), new THREE.MeshStandardMaterial({color:0x111111})); floor.rotation.x=-Math.PI/2; scene.add(floor);
    // LumiÃ¨re
    let light=new THREE.DirectionalLight(0xffffff,1); light.position.set(10,20,10); scene.add(light);
    let amb=new THREE.AmbientLight(0x404040); scene.add(amb);

    createWeapon();
    if(!isMobile) setupPCControls(); else setupMobileControls();
    window.addEventListener('resize',()=>{camera.aspect=window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth,window.innerHeight);});
}

function createWeapon(){
    weapon=new THREE.Group();
    let body=new THREE.BoxGeometry(0.1,0.1,0.5), mat=new THREE.MeshStandardMaterial({color:0x222222,metalness:0.8,roughness:0.2});
    weapon.add(new THREE.Mesh(body,mat));
    weapon.position.set(0.3,-0.3,-0.5);
    camera.add(weapon); scene.add(camera);
}

function createTargets(){
    targets=[];
    for(let i=0;i<modeConfig.gridshot.count;i++){
        let geo=new THREE.CylinderGeometry(modeConfig.gridshot.size,modeConfig.gridshot.size,0.2,32);
        let mat=new THREE.MeshStandardMaterial({color:0xff0044,emissive:0xff0044,emissiveIntensity:0.8});
        let t=new THREE.Mesh(geo,mat); t.rotation.x=Math.PI/2;
        t.position.set((i%3-1)*modeConfig.gridshot.spacing,1.5+Math.floor(i/3)*modeConfig.gridshot.spacing/2,-10); scene.add(t); targets.push(t);
    }
}

function setupPCControls(){
    document.addEventListener('keydown',e=>keys[e.code]=true);
    document.addEventListener('keyup',e=>keys[e.code]=false);
    document.addEventListener('mousemove',e=>{if(!isPlaying) return; camera.rotation.y-=e.movementX*0.002; camera.rotation.x-=e.movementY*0.002; camera.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,camera.rotation.x));});
    renderer.domElement.addEventListener('click',()=>{renderer.domElement.requestPointerLock();});
}

let joystickActive=false, joyStart={x:0,y:0}, joyCurrent={x:0,y:0};
function setupMobileControls(){
    mobileControls.classList.add('active');
    const jc=document.querySelector('.joystick-container');
    jc.addEventListener('touchstart',e=>{e.preventDefault(); joystickActive=true; const r=jc.getBoundingClientRect(); joyStart.x=r.left+r.width/2; joyStart.y=r.top+r.height/2;});
    document.addEventListener('touchmove',e=>{if(!joystickActive) return; const t=e.touches[0]; const dx=t.clientX-joyStart.x, dy=t.clientY-joyStart.y; const maxD=35; const dist=Math.min(maxD,Math.sqrt(dx*dx+dy*dy)), angle=Math.atan2(dy,dx); joyCurrent.x=Math.cos(angle)*dist; joyCurrent.y=Math.sin(angle)*dist; joystickEl.style.transform=`translate(calc(-50% + ${joyCurrent.x}px),calc(-50% + ${joyCurrent.y}px))`;});
    document.addEventListener('touchend',()=>{joystickActive=false; joyCurrent={x:0,y:0}; joystickEl.style.transform='translate(-50%,-50%)';});
}

function updateMovement(delta){
    move.forward=keys['KeyW']||keys['ArrowUp']|| (isMobile && joyCurrent.y<-0.3);
    move.backward=keys['KeyS']||keys['ArrowDown']|| (isMobile && joyCurrent.y>0.3);
    move.left=keys['KeyA']||keys['ArrowLeft']|| (isMobile && joyCurrent.x<-0.3);
    move.right=keys['KeyD']||keys['ArrowRight']|| (isMobile && joyCurrent.x>0.3);
    const velocity=new THREE.Vector3();
    const dir=new THREE.Vector3();
    dir.z=Number(move.forward)-Number(move.backward); dir.x=Number(move.right)-Number(move.left); dir.normalize();
    if(move.forward||move.backward) velocity.z=-dir.z*5*delta;
    if(move.left||move.right) velocity.x=-dir.x*5*delta;
    const forward=new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion); forward.y=0; forward.normalize();
    const right=new THREE.Vector3(1,0,0).applyQuaternion(camera.quaternion); right.y=0; right.normalize();
    camera.position.addScaledVector(forward,velocity.z);
    camera.position.addScaledVector(right,velocity.x);
}

function shoot(){
    if(!isPlaying) return;
    totalShots++;
    raycaster.set(camera.position,new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion));
    const intersects=raycaster.intersectObjects(targets);
    if(intersects.length>0){
        let t=intersects[0].object; hits++; score+=100; scoreEl.textContent=score;
        t.material.color.setHex(0x00ff00); setTimeout(()=>{t.material.color.setHex(0xff0044);},100);
    }
}

function animate(){
    if(!isPlaying) return;
    requestAnimationFrame(animate);
    const delta=0.016;
    updateMovement(delta);
    renderer.render(scene,camera);
}
function endGame(){isPlaying=false; alert(`Score: ${score}\nHits: ${hits}\nTotal shots: ${totalShots}`);}
</script>
</body>
</html>
