
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>QRForge Ultimate</title>
<style>
:root{
  --bg:#0d0d0d; --card:#1a1a1a; --text:white; --input:#2b2b2b; --accent:#00c4ff;
}
[data-theme="light"]{
  --bg:#f2f2f2; --card:#fff; --text:#111; --input:#e5e5e5; --accent:#007acc;
}
body{
  margin:0; font-family:Arial,sans-serif; background:var(--bg); color:var(--text);
}
.card{
  background:var(--card); border-radius:15px; padding:20px; max-width:400px; margin:15px auto;
  box-shadow:0 0 15px rgba(0,0,0,0.4); transition:0.3s;
}
.card:hover{box-shadow:0 0 25px rgba(0,0,0,0.6);}
input,select,button{width:100%; padding:12px; margin-top:10px; border-radius:10px; border:none; font-size:16px;}
input,select{background:var(--input); color:var(--text);}
button{background:var(--accent); color:black; font-weight:bold; cursor:pointer; transition:0.2s;}
button:hover{opacity:0.85;}
button:active{transform:scale(0.97);}
.topbar{display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:var(--card);}
.bottomNav{position:fixed; bottom:0; left:0; width:100%; display:flex; justify-content:space-around; background:var(--card); padding:10px 0; border-top:1px solid #333;}
.navBtn{cursor:pointer; padding:6px 12px; border-radius:10px; transition:0.2s;}
.navActive{background:var(--accent); color:black;}
#qrcode{background:white; padding:10px; margin:10px auto; border-radius:20px; width:fit-content; position:relative;}
#qrcode img{border-radius:20px;}
.historyItem{display:flex; align-items:center; justify-content:space-between; padding:8px; margin:8px 0; border-radius:12px; background:var(--input); transition:0.3s;}
.historyItem:hover{transform:scale(1.02);}
.historyItem img{width:50px; height:50px; border-radius:12px; margin-left:10px;}
.historyContent{flex:1;}
</style>
</head>
<body data-theme="dark">

<!-- LOGIN -->
<div id="loginPage" class="card" style="margin-top:50px;">
<h2>Connexion</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Mot de passe">
<button onclick="login()">Se connecter</button>
</div>

<!-- APP -->
<div id="appPage" style="display:none;">
<div class="topbar"><h2>QRForge</h2><button onclick="logout()">Déconnexion</button></div>
<div class="card">
<label>Nom du QR (obligatoire)</label><input type="text" id="qrName" placeholder="Ex: Mon QR">
<label>Texte / Lien</label><input type="text" id="text" placeholder="Tape ici…">
<label>Couleur du QR</label><input type="color" id="color" value="#000000">
<label>Taille</label>
<select id="size">
<option value="150">150px</option>
<option value="200" selected>200px</option>
<option value="250">250px</option>
<option value="300">300px</option>
</select>
<div id="qrcode"></div>
<button id="downloadBtn">Télécharger QR</button>
</div>
</div>

<!-- HISTORIQUE -->
<div id="historyPage" style="display:none;">
<div class="topbar"><h2>Historique</h2><button onclick="logout()">Déconnexion</button></div>
<div class="card" id="historyList"><p>Aucun QR généré.</p></div>
</div>

<!-- PROFIL -->
<div id="profilePage" style="display:none;">
<div class="topbar"><h2>Profil</h2><button onclick="logout()">Déconnexion</button></div>
<div class="card">
<p><strong>Email :</strong> <span id="userEmail"></span></p>
<label>Thème :</label>
<select id="themeSelect"><option value="dark">Sombre</option><option value="light">Clair</option></select>
</div>
</div>

<!-- NAV -->
<div class="bottomNav">
<div class="navBtn navActive" onclick="switchPage('appPage',this)">QR</div>
<div class="navBtn" onclick="switchPage('historyPage',this)">Historique</div>
<div class="navBtn" onclick="switchPage('profilePage',this)">Profil</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<script>
// ---------- LOGIN ----------
function login(){
let email=document.getElementById("email").value.trim();
let pass=document.getElementById("password").value.trim();
if(!email||!pass){alert("Remplis tout.");return;}
localStorage.setItem("qr_user",email);
showApp();
}
function logout(){localStorage.removeItem("qr_user");location.reload();}
function showApp(){
document.getElementById("loginPage").style.display="none";
document.getElementById("appPage").style.display="block";
document.getElementById("userEmail").textContent=localStorage.getItem("qr_user");
loadHistory();
}
// ---------- NAV ----------
function switchPage(id,btn){
['appPage','historyPage','profilePage'].forEach(e=>document.getElementById(e).style.display="none");
document.getElementById(id).style.display="block";
document.querySelectorAll('.navBtn').forEach(e=>e.classList.remove('navActive'));
btn.classList.add('navActive');
}
// ---------- THEME ----------
const themeSelect=document.getElementById("themeSelect");
themeSelect.addEventListener("change",()=>document.body.setAttribute("data-theme",themeSelect.value));
// ---------- QR GENERATION ----------
let qrDiv=document.getElementById("qrcode"),qr;
let logoSrc="https://upload.wikimedia.org/wikipedia/commons/6/6b/QR_Code.png"; // placeholder logo
function genererQR(){
let name=document.getElementById("qrName").value.trim();
let txt=document.getElementById("text").value.trim();
let color=document.getElementById("color").value;
let size=parseInt(document.getElementById("size").value);
if(!txt||!name) return;
qrDiv.innerHTML="";
qr=new QRCode(qrDiv,{text:txt,width:size,height:size,colorDark:color,colorLight:"#fff"});
// ajouter logo au centre
let img=document.createElement("img");
img.src=logoSrc;
img.style.width=(size/4)+"px"; img.style.height=(size/4)+"px";
img.style.position="absolute"; img.style.top="50%"; img.style.left="50%";
img.style.transform="translate(-50%,-50%)"; img.style.pointerEvents="none";
qrDiv.appendChild(img);
saveHistory(name,txt,color,size);
}
document.getElementById("text").addEventListener("input",genererQR);
document.getElementById("color").addEventListener("input",genererQR);
document.getElementById("size").addEventListener("change",genererQR);
document.getElementById("qrName").addEventListener("input",genererQR);
// ---------- DOWNLOAD ----------
document.getElementById("downloadBtn").onclick=()=>{
let qrImg=qrDiv.querySelector("img");
if(!qrImg){alert("Génère le QR d'abord!");return;}
// créer canvas pour merger QR + logo
let qrCanvas=document.createElement("canvas");
let imgQr=qrDiv.querySelector("img");
let qrCanvasElem=qrDiv.querySelector("canvas");
if(qrCanvasElem){qrCanvas.width=qrCanvasElem.width; qrCanvas.height=qrCanvasElem.height; let ctx=qrCanvas.getContext("2d"); ctx.drawImage(qrCanvasElem,0,0); let logo=new Image(); logo.src=logoSrc; logo.onload=()=>{ctx.drawImage(logo,(qrCanvas.width/2)-(qrCanvas.width/8),(qrCanvas.height/2)-(qrCanvas.height/8),qrCanvas.width/4,qrCanvas.height/4); let link=document.createElement("a"); link.href=qrCanvas.toDataURL(); link.download=document.getElementById("qrName").value+".png"; link.click(); }}};// ---------- HISTORIQUE ----------
function saveHistory(name,txt,color,size){
    let history=JSON.parse(localStorage.getItem("qr_history")||"[]");
    let timestamp=new Date().toLocaleString();
    let entry={name,txt,color,size};
    history.unshift(entry);
    if(history.length>20) history.pop(); // max 20 QR
    localStorage.setItem("qr_history",JSON.stringify(history));
    loadHistory();
}

function loadHistory(){
    let list=document.getElementById("historyList");
    let history=JSON.parse(localStorage.getItem("qr_history")||"[]");
    list.innerHTML="";
    if(history.length==0){list.innerHTML="<p>Aucun QR généré.</p>"; return;}
    history.forEach(item=>{
        let div=document.createElement("div");
        div.className="historyItem";
        
        // QR miniature
        let qrBox=document.createElement("div");
        qrBox.style.position="relative";
        let qrMini=document.createElement("div");
        new QRCode(qrMini,{text:item.txt,width:50,height:50,colorDark:item.color,colorLight:"#fff"});
        qrBox.appendChild(qrMini);
        // logo miniature
        let logoMini=document.createElement("img");
        logoMini.src=logoSrc;
        logoMini.style.width="12px";
        logoMini.style.height="12px";
        logoMini.style.position="absolute";
        logoMini.style.top="50%";
        logoMini.style.left="50%";
        logoMini.style.transform="translate(-50%,-50%)";
        qrBox.appendChild(logoMini);
        
        // texte nom + date
        let infoDiv=document.createElement("div");
        infoDiv.className="historyContent";
        infoDiv.innerHTML=`<strong>${item.name}</strong><br>${new Date().toLocaleString()}`;
        
        // bouton download
        let dlBtn=document.createElement("button");
        dlBtn.textContent="Télécharger";
        dlBtn.onclick=()=>{
            let qrCanvas=document.createElement("canvas");
            let qrCanvasElem=qrMini.querySelector("canvas");
            if(qrCanvasElem){
                qrCanvas.width=qrCanvasElem.width;
                qrCanvas.height=qrCanvasElem.height;
                let ctx=qrCanvas.getContext("2d");
                ctx.drawImage(qrCanvasElem,0,0);
                let logo=new Image();
                logo.src=logoSrc;
                logo.onload=()=>{
                    ctx.drawImage(logo,(qrCanvas.width/2)-(qrCanvas.width/8),(qrCanvas.height/2)-(qrCanvas.height/8),qrCanvas.width/4,qrCanvas.height/4);
                    let link=document.createElement("a");
                    link.href=qrCanvas.toDataURL();
                    link.download=item.name+".png";
                    link.click();
                }
            }
        };
        
        div.appendChild(infoDiv);
        div.appendChild(qrBox);
        div.appendChild(dlBtn);
        list.appendChild(div);
    });
}

// ---------- AUTO LOGIN ----------
if(localStorage.getItem("qr_user")) showApp();
</script>
</body>
</html>