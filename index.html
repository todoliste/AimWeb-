<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>AimLab 3D Mini</title>
<style>
  body, html { margin:0; padding:0; overflow:hidden; font-family:sans-serif; background:#000; color:#fff; }
  #menu { position:fixed; top:0; left:0; width:100%; height:100%; background:linear-gradient(135deg,#0f0c29,#302b63,#24243e); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:100; }
  #menu h1 { font-size:4rem; margin-bottom:30px; background:linear-gradient(45deg,#00f5ff,#ff00ff); -webkit-background-clip:text; -webkit-text-fill-color:transparent;}
  .mode-btn { margin:10px; padding:20px 40px; font-size:1.5rem; border-radius:10px; border:2px solid #00f5ff; background:rgba(0,0,0,0.5); color:#fff; cursor:pointer; transition:0.3s; }
  .mode-btn:hover { background:#00f5ff; color:#000; }
  #start-btn { margin-top:30px; padding:15px 60px; font-size:1.5rem; border-radius:30px; background:linear-gradient(135deg,#00f5ff,#ff00ff); border:none; cursor:pointer; }
  #hud { position:fixed; top:0; left:0; padding:10px; font-size:1.2rem; display:none; }
  #canvas-container { width:100%; height:100%; display:none; }
  #crosshair { position:fixed; top:50%; left:50%; width:4px; height:4px; background:#0f0; transform:translate(-50%,-50%); }
</style>
</head>
<body>

<div id="menu">
  <h1>AimLab 3D</h1>
  <div class="mode-btn" data-mode="gridshot">Gridshot</div>
  <div class="mode-btn" data-mode="tracking">Tracking</div>
  <button id="start-btn" disabled>Commencer</button>
</div>

<div id="hud">Score: <span id="score">0</span> | Time: <span id="timer">60</span></div>
<div id="canvas-container"></div>
<div id="crosshair"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>

let config = { mode:null, score:0, hits:0, totalShots:0, time:60, playing:false };
const menu = document.getElementById('menu');
const startBtn = document.getElementById('start-btn');
const modeBtns = document.querySelectorAll('.mode-btn');
const hud = document.getElementById('hud');
const scoreEl = document.getElementById('score');
const timerEl = document.getElementById('timer');
const canvasContainer = document.getElementById('canvas-container');

modeBtns.forEach(btn=>{
  btn.onclick=()=>{
    modeBtns.forEach(b=>b.style.border='2px solid #00f5ff');
    btn.style.border='2px solid #ff0';
    config.mode=btn.dataset.mode;
    startBtn.disabled=false;
  }
});

startBtn.onclick=startGame;

let scene, camera, renderer, raycaster, targets=[], keys={};

function startGame(){
  menu.style.display='none';
  canvasContainer.style.display='block';
  hud.style.display='block';
  config.playing=true;
  config.score=0;
  config.hits=0;
  config.totalShots=0;
  config.time=60;

  initThree();
  spawnTargets();
  animate();
  setInterval(()=>{ if(config.time>0) { config.time--; timerEl.textContent=config.time } else { endGame() } },1000);
}

function initThree(){
  scene = new THREE.Scene();
  scene.background=new THREE.Color(0x111111);
  camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
  camera.position.set(0,1.6,5);
  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth,window.innerHeight);
  canvasContainer.appendChild(renderer.domElement);
  raycaster = new THREE.Raycaster();

  // Sol simple
  const floor = new THREE.Mesh(new THREE.PlaneGeometry(100,100), new THREE.MeshStandardMaterial({color:0x222222}));
  floor.rotation.x=-Math.PI/2;
  scene.add(floor);

  const light=new THREE.DirectionalLight(0xffffff,1);
  light.position.set(10,20,10);
  scene.add(light);

  window.addEventListener('keydown',e=>keys[e.code]=true);
  window.addEventListener('keyup',e=>keys[e.code]=false);
  window.addEventListener('mousemove',e=>{
    if(!config.playing) return;
    camera.rotation.y -= e.movementX*0.002;
    camera.rotation.x -= e.movementY*0.002;
    camera.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,camera.rotation.x));
  });
  renderer.domElement.addEventListener('click',()=>shoot());
}

function spawnTargets(){
  for(let i=0;i<5;i++){
    const t=new THREE.Mesh(new THREE.SphereGeometry(0.5,16,16),new THREE.MeshStandardMaterial({color:0xff0000}));
    t.position.set((Math.random()-0.5)*10,1,(Math.random()-0.5)*-10);
    scene.add(t);
    targets.push(t);
  }
}

function shoot(){
  if(!config.playing) return;
  config.totalShots++;
  const dir=new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion);
  raycaster.set(camera.position,dir);
  const intersects=raycaster.intersectObjects(targets);
  if(intersects.length>0){
    intersects[0].object.material.color.set(0x00ff00);
    config.hits++;
    config.score+=10;
    scoreEl.textContent=config.score;
    setTimeout(()=>{ intersects[0].object.material.color.set(0xff0000); },200);
  }
}

function animate(){
  if(!config.playing) return;
  requestAnimationFrame(animate);
  const speed=0.1;
  if(keys['KeyW']) camera.position.add(new THREE.Vector3(0,0,-speed).applyQuaternion(camera.quaternion));
  if(keys['KeyS']) camera.position.add(new THREE.Vector3(0,0,speed).applyQuaternion(camera.quaternion));
  if(keys['KeyA']) camera.position.add(new THREE.Vector3(-speed,0,0).applyQuaternion(camera.quaternion));
  if(keys['KeyD']) camera.position.add(new THREE.Vector3(speed,0,0).applyQuaternion(camera.quaternion));
  renderer.render(scene,camera);
}

function endGame(){
  config.playing=false;
  alert(`Fin du jeu ! Score: ${config.score} | Hits: ${config.hits}`);
  location.reload();
}

</script>
</body>
</html>
