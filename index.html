<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Masque Flou Drag & Drop</title>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: #111;
    color: #fff;
    font-family: sans-serif;
    margin: 0;
    padding: 20px;
  }
  canvas {
    border: 2px solid #fff;
    cursor: grab;
  }
  #controls {
    margin: 10px;
  }
  input, button {
    margin: 5px;
    padding: 5px 10px;
    font-size: 16px;
  }
</style>
</head>
<body>
<h1>Masque Flou Drag & Drop</h1>
<input type="file" id="upload" accept="image/*">
<div id="controls">
  <button id="reset">Réinitialiser</button>
</div>
<canvas id="canvas" width="800" height="600"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const upload = document.getElementById('upload');
const resetBtn = document.getElementById('reset');

let img = new Image();
let mask = {x: 200, y: 150, w: 400, h: 300};
let dragging = false;
let offsetX, offsetY;

// Charger l'image
upload.addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = event => img.src = event.target.result;
    reader.readAsDataURL(file);
});

// Dessiner image + masque flou
function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(img,0,0,canvas.width,canvas.height);

    // Flou dans le masque
    ctx.save();
    ctx.filter = 'blur(10px)';
    ctx.beginPath();
    ctx.rect(mask.x, mask.y, mask.w, mask.h);
    ctx.clip();
    ctx.drawImage(img,0,0,canvas.width,canvas.height);
    ctx.restore();

    // Contour du masque
    ctx.strokeStyle = '#0f0';
    ctx.lineWidth = 3;
    ctx.strokeRect(mask.x, mask.y, mask.w, mask.h);
}

// Drag & Drop du rectangle
canvas.addEventListener('mousedown', e => {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    if (x > mask.x && x < mask.x + mask.w && y > mask.y && y < mask.y + mask.h) {
        dragging = true;
        offsetX = x - mask.x;
        offsetY = y - mask.y;
        canvas.style.cursor = 'grabbing';
    }
});
canvas.addEventListener('mouseup', () => { dragging = false; canvas.style.cursor = 'grab'; });
canvas.addEventListener('mouseleave', () => { dragging = false; canvas.style.cursor = 'grab'; });
canvas.addEventListener('mousemove', e => {
    if (!dragging) return;
    const rect = canvas.getBoundingClientRect();
    mask.x = e.clientX - rect.left - offsetX;
    mask.y = e.clientY - rect.top - offsetY;
    draw();
});

// Reset du masque
resetBtn.addEventListener('click', () => {
    mask = {x: 200, y: 150, w: 400, h: 300};
    draw();
});

// Redessiner après chargement de l'image
img.onload = draw;
</script>
</body>
</html>